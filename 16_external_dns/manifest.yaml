apiVersion: v1
kind: ServiceAccount
metadata:
  name: external-dns
  namespace: kube-system #Or whatever namespace you choose

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: external-dns
rules:
  - apiGroups: [""]
    resources: ["services", "endpoints", "pods"]
    verbs: ["get", "watch", "list"]
  - apiGroups: [""]
    resources: ["namespaces"]
    verbs: ["get", "watch", "list"]
  - apiGroups: ["extensions"]
    resources: ["ingresses"]
    verbs: ["get", "watch", "list"]
  - apiGroups: ["networking.k8s.io"]
    resources: ["ingresses"]
    verbs: ["get", "watch", "list"]
  - apiGroups: ["route.openshift.io"]
    resources: ["routes"]
    verbs: ["get", "watch", "list"]
  - apiGroups: [""]
    resources: ["services/status"]
    verbs: ["update"]
  - apiGroups: ["route.openshift.io"]
    resources: ["routes/status"]
    verbs: ["update"]

---

apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: external-dns
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: external-dns
subjects:
  - kind: ServiceAccount
    name: external-dns
    namespace: kube-system #Or whatever namespace you choose

---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: external-dns
  namespace: kube-system #Or whatever namespace you choose
  labels:
    app: external-dns
spec:
  selector:
    matchLabels:
      app: external-dns
  replicas: 1
  template:
    metadata:
      labels:
        app: external-dns
    spec:
      serviceAccountName: external-dns
      containers:
        - name: external-dns
          image: external-dns/external-dns:v0.15.0 # Use the latest version
          args:
            - "--source=service"
            - "--source=ingress"
            - "--domain-filter=your-domain.com" # Replace with your domain
            - "--provider=digitalocean" # Replace with your provider
            - "--poll-interval=30s"
            - "--dry-run=false"
            - "--txt-owner-id=your-txt-owner-id" # Replace with your TXT owner id
            - "--digitalocean-token=your-digitalocean-token" # Replace with your token
          imagePullPolicy: IfNotPresent